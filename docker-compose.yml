services:
  ezguard-api:
    build:
      context: .
      dockerfile: Dockerfile
    image: ezguard-api:latest
    container_name: ezguard-api
    restart: unless-stopped
    ports:
      - "${EXTERNAL_PORT:-3050}:3050"
    environment:
      - TOKEN=${TOKEN}
      - EZGUARD_EMAIL=${EZGUARD_EMAIL}
      - EZGUARD_PASSWORD=${EZGUARD_PASSWORD}
      - EZGUARD_API_BASE_URL=${EZGUARD_API_BASE_URL:-https://webapi.ez-guard.com/v3}
      - PORT=3050
    env_file:
      - .env
    networks:
      - ezguard-network
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3050/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

networks:
  ezguard-network:
    driver: bridge
